@using AVStaffing.Infrastructure
@using AVStaffing.Models.Entities
@{
    var notifications = ViewBag.Notifications as List<Notification>;
    if (notifications == null)
    {
        notifications = new List<Notification>();
    }
    var user = ViewBag.SessionUser as ApplicationUser;
    ViewBag.Title = "HR System";
    Layout = null;
}



<!DOCTYPE html>
<html>
<head>
    <base href="">
    <meta charset="utf-8" />
    <title>@ViewBag.Title | Dashboard</title>
    <meta name="description" content="Updates and statistics" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />


    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.3.0/css/flag-icon.min.css" rel="stylesheet" />

    <link href="@Url.Content("~/Backend/assets/plugins/custom/fullcalendar/fullcalendar.bundle.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Backend/assets/plugins/global/plugins.bundle.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Backend/assets/plugins/custom/prismjs/prismjs.bundle.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Backend/assets/css/style.bundle.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/font-awesome.min.css")" rel="stylesheet" />
    <link href="@Url.Content("~/Backend/assets/plugins/custom/datatables/datatables.bundle.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/plugins/bootstrap-select-country/dist/css/bootstrap-select-country.min.css")" rel="stylesheet" />
    <link href="@Url.Content("~/plugins/datepicker/datepicker.css")" rel="stylesheet" />
    <link href="@Url.Content("~/plugins/jqueryui/custom-theme/jquery-ui-1.10.4.custom.css")" rel="stylesheet" />
    <link href="@Url.Content("~/plugins/jquery.signature/css/jquery.signature.css")" rel="stylesheet" />
    <link href="@Url.Content("~/Backend/assets/plugins/custom/datetimepickerb4/build/css/bootstrap-datetimepicker.min.css")" rel="stylesheet" />
    <style>
        .flag-text {
            margin-left: 10px;
        }
    </style>
</head>
<body id="kt_body" class="header-fixed header-mobile-fixed page-loading">
    @RenderBody()

    <script>
        var KTAppSettings = {
            "breakpoints": {
                "sm": 576,
                "md": 768,
                "lg": 992,
                "xl": 1200,
                "xxl": 1200
            },
            "colors": {
                "theme": {
                    "base": {
                        "white": "#ffffff",
                        "primary": "#6993FF",
                        "secondary": "#E5EAEE",
                        "success": "#1BC5BD",
                        "info": "#8950FC",
                        "warning": "#FFA800",
                        "danger": "#F64E60",
                        "light": "#F3F6F9",
                        "dark": "#212121"
                    },
                    "light": {
                        "white": "#ffffff",
                        "primary": "#E1E9FF",
                        "secondary": "#ECF0F3",
                        "success": "#C9F7F5",
                        "info": "#EEE5FF",
                        "warning": "#FFF4DE",
                        "danger": "#FFE2E5",
                        "light": "#F3F6F9",
                        "dark": "#D6D6E0"
                    },
                    "inverse": {
                        "white": "#ffffff",
                        "primary": "#ffffff",
                        "secondary": "#212121",
                        "success": "#ffffff",
                        "info": "#ffffff",
                        "warning": "#ffffff",
                        "danger": "#ffffff",
                        "light": "#464E5F",
                        "dark": "#ffffff"
                    }
                },
                "gray": {
                    "gray-100": "#F3F6F9",
                    "gray-200": "#ECF0F3",
                    "gray-300": "#E5EAEE",
                    "gray-400": "#D6D6E0",
                    "gray-500": "#B5B5C3",
                    "gray-600": "#80808F",
                    "gray-700": "#464E5F",
                    "gray-800": "#1B283F",
                    "gray-900": "#212121"
                }
            },
            "font-family": "Poppins"
        };
    </script>

    @*<script src="@Url.Content("~/Scripts/jquery-3.1.1.min.js")"></script>*@
    <script src="@Url.Content("~/Backend/assets/plugins/global/plugins.bundle.js")"></script>
    <script src="@Url.Content("~/Backend/assets/plugins/select2.js")"></script>
    <script src="@Url.Content("~/Backend/assets/plugins/custom/prismjs/prismjs.bundle.js")"></script>
    <script src="@Url.Content("~/Backend/assets/js/scripts.bundle.js")"></script>
    <script src="@Url.Content("~/plugins/jqueryui/jqueryui.min.js")"></script>

    <script src="@Url.Content("~/plugins/inputmask/jquery.inputmask.min.js")"></script>
    <script src="@Url.Content("~/Backend/assets/plugins/custom/datatables/datatables.bundle.js")"></script>
    <script src="@Url.Content("~/Backend/assets/js/pages/crud/datatables/extensions/responsive.js")"></script>
    <script src="@Url.Content("~/Backend/assets/plugins/custom/fullcalendar/fullcalendar.bundle.js")"></script>
    <script src="@Url.Content("~/Backend/assets/js/pages/widgets.js")"></script>
    <script src="@Url.Content("~/Scripts/jquery.signalR-2.4.1.min.js")"></script>
    <script src="@Url.Content("~/Scripts/jquery-migrate.js")"></script>
    <script src="@Url.Content("~/signalr/hubs")"></script>
    <script src="@Url.Content("~/Scripts/bootbox.js")"></script>
    <script src="@Url.Content("~/Scripts/moment.js")"></script>
    <script src="@Url.Content("~/Backend/assets/plugins/custom/datetimepickerb4/build/js/bootstrap-datetimepicker.min.js")"></script>
    <script src="@Url.Content("~/Scripts/vue.js")"></script>
    <script src="@Url.Content("~/Scripts/swal.js")"></script>
    <script src="@Url.Content("~/plugins/bootstrap-select-country/dist/js/bootstrap-select-country.min.js")"></script>
    <script src="@Url.Content("~/plugins/jquery.signature/js/jquery.signature.min.js")"></script>
    <script type="text/javascript">

        function formatDate(jsonDate) {
            var d = new Date(parseInt(jsonDate.substr(6)));
            return new Date(d);
        }


        function Notify(message) {
            Swal.fire({
                icon: message.Type.toLowerCase(),
                title: message.Title,
                html: message.Message
            })
        }

        function isNullOrEmpty(s) {
            return (s == null || s === "");
        }

        function readURL(input) {
            var id = $(input).attr("data-src");
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    $(id).attr("src", e.target.result);
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function readURL2(input) {
            console.log("called");
            var id = $(input).attr("data-src");
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function(e) {

                    $(id).css("background-image", "url(" + e.target.result + ")");

                    //$(id).css("background", e.target.result);
                    //$(id).attr("src", e.target.result);
                }
                reader.readAsDataURL(input.files[0]);
            }
        }


        $(document).ready(function() {

            //$(".select2").select2();

            $('.dataTable').dataTable({
                responsive: true
            });

            $(".datepicker").datepicker();
            $(".datetimepicker").datetimepicker({
                format : 'YYYY-MM-DD hh:mm A'
                //dateFormat: "yy-mm-dd",
                //timeFormat: 'HH:mm:ss'
            });

            //$('body').on('click',
            //    '.datetimepicker',
            //    function () {
            //        var pos = $(this).offset();
            //        var top = pos.top;
            //        var left = pos.left;
            //        $(this).not('.hasDateTimePicker').datetimepicker({
            //            controlType: 'select',
            //            changeMonth: true,
            //            changeYear: true,
            //            dateFormat: "yy-mm-dd",
            //            timeFormat: 'HH:mm:ss',
            //            yearRange: "1900:+10",
            //            showOn: 'focus',
            //            firstDay: 1
            //        }).focus();
            //        $("#ui-datepicker-div").css({ top: top, left: left, position: 'absolute' });
            //    });


            $("#notificationBell").click(function (e) {
                e.preventDefault();
                console.log($("#notificationDropdown").is(":hidden"));
                if ($("#notificationDropdown").is(":hidden")) {
                    ShowNotifications();
                } else {
                    HideNotifications();
                }
            });


            function HideNotifications() {
                $("#notificationCountSpan").show();
                $("#notificationDropdown").dropdown('hide');
            }

            function ShowNotifications() {
                $("#notificationCountSpan").hide();
                $("#notificationList").html("");
                $.post("@Url.Action("GetNotifications", "Notification")", function (resp) {

                var html = "";
                $.each(resp, function (i, v) {
                    html += `
                                                        <div class="d-flex align-items-center mb-6">
                                                            <div class="symbol symbol-40 symbol-light-primedicalRecordy mr-5">
                                                                <span class="symbol-label">
                                                                    <span class="svg-icon svg-icon-lg svg-icon-primedicalRecordy">
                                                                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                                                            <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                                                <rect x="0" y="0" width="24" height="24" />
                                                                                <path d="M5,3 L6,3 C6.55228475,3 7,3.44771525 7,4 L7,20 C7,20.5522847 6.55228475,21 6,21 L5,21 C4.44771525,21 4,20.5522847 4,20 L4,4 C4,3.44771525 4.44771525,3 5,3 Z M10,3 L11,3 C11.5522847,3 12,3.44771525 12,4 L12,20 C12,20.5522847 11.5522847,21 11,21 L10,21 C9.44771525,21 9,20.5522847 9,20 L9,4 C9,3.44771525 9.44771525,3 10,3 Z" fill="#000000" />
                                                                                <rect fill="#000000" opacity="0.3" transform="translate(17.825568, 11.945519) rotate(-19.000000) translate(-17.825568, -11.945519) " x="16.3255682" y="2.94551858" width="3" height="18" rx="1" />
                                                                            </g>
                                                                        </svg>
                                                                    </span>
                                                                </span>
                                                            </div>

                                                            <div class="d-flex flex-column font-weight-bold">
                                                                <a href="#" class="text-dark text-hover-primedicalRecordy mb-1 font-size-lg">${moment(formatDate(v.DateCreated)).format('DD MMM YYYY hh:mm A') }</a>
                                                                <span class="text-muted">${v.Message} </span>
                                                            </div>
                                                        </div>

`;
                });
                console.log(html);
                $("#notificationList").html(html);
                $("#notificationDropdown").dropdown('toggle');
            });
        }


        function setTotalNotification(totalNotify) {
            console.log(totalNotify);
            if (totalNotify != "0") {
                //"notificationCountSpan"
                $(".notificationCount").html(totalNotify + " new");
                $("#notificationCountSpan").html(totalNotify);
                $("#notificationCountSpan").show();
            }

        }

        //var hub = $.connection.notificationHub;

        ////Client Call
        //hub.client.broadcaastNotif = function (totalNotify) {
        //    console.log("called");
        //    setTotalNotification(totalNotify);
        //};

        //hub.client.notify = function (notification) {
        //    console.log("called");
        //    Notify(notification);
        //};



        //    $.connection.hub.start().done(function () {
        //        console.log("Hub Connected!");
        //        hub.server.getNotification();

        //    })
        //    .fail(function () {
        //        console.log("Could not Connect!");
        //    });
    });
    </script>
    @if (ViewBag.NotificationMessage != null)
    {
        <script>
        $(function () {
            var message = @(Html.Raw(Json.Encode(ViewBag.NotificationMessage)));
            if (message.IsViewMessage) {
                Notify(message);
            }
        });
        </script>
    }
    @if (TempData["NotificationMessage"] != null)
    {
        <script>
        $(function () {
            var message = @(Html.Raw(Json.Encode(TempData["NotificationMessage"])));
            if (message.IsRedirectMessage) {
                Notify(message);
            }
        });
        </script>
    }
    @RenderSection("Scripts", false)



</body>
<!--end::Body-->
</html>
